# MariaDB

Dokku has official support for [mariadb](https://mariadb.org/), a good and mature open source relational database and drop-in replacement for MySQL. The [dokku plugin](https://github.com/dokku/dokku-mariadb) for this is well documented. It can be used to launch & manage databases and link them to apps.

## Setup terminal

As in the deployment phase, dokku commands can be setup with
```bash
alias dokku="ssh -t dokku@dokku.maayanlab.cloud"
```

## Creating a database for your app

```bash
# create the database
dokku mariadb:create <db-name>

# connect to the database
dokku mariadb:connect <db-name>
```

## Provisioning the database from an existing database

```bash
# dump data from local database
#  (NOTE: mysqldump likely requires additional parameters like the hostname, username & password to local db)
mysqldump db_name > db.dump

# send dump to dokku database
dokku mariadb:import <db-name> < db.dump
```

## Linking the database to your app

```bash
# assuming the db and app are created
dokku mariadb:link <db-name> <app-name>
```

This will set an environment variable: `DATABASE_URL` which contains a connection URI of the form `mysql://<username>:<auto-generated-password>@<service-name>:5432/<db-name>`.

Importantly, your app should receive this variable and use it to configure the database. For example, in python:

```python
import os
import mysql.connector

DATABASE_URL = os.environ.get('DATABASE_URL')
assert DATABASE_URL is not None, 'Missing DATABASE_URL environment variable to connect to the database'

# connect to db
conn = mysql.connector.connect(DATABASE_URL)

# ... use conn in your app to build queries ...

conn.close()
```

## Exporting from dokku mariadb

```bash
# data in a dokku database can also be exported similarly to pg_dump
dokku mariadb:export <db-name> > db.dump
```
